!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&"function"==typeof require?e(require("jquery")):e(jQuery)}(function(h){"use strict";function i(e,t){var n=function(){},o=this,s={ajaxSettings:{},autoSelectFirst:!1,appendTo:document.body,serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:i.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:n,onSearchComplete:n,onSearchError:n,preserveInput:!1,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,triggerSelectOnValidInput:!0,preventBadQueries:!0,lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(e){return"string"==typeof e?h.parseJSON(e):e},showNoSuggestionNotice:!1,noSuggestionNotice:"No results",orientation:"bottom",forceFixPosition:!1};o.element=e,o.el=h(e),o.suggestions=[],o.badQueries=[],o.selectedIndex=-1,o.currentValue=o.element.value,o.intervalId=0,o.cachedResponse={},o.onChangeInterval=null,o.onChange=null,o.isLocal=!1,o.suggestionsContainer=null,o.noSuggestionsContainer=null,o.options=h.extend({},s,t),o.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},o.hint=null,o.hintValue="",o.selection=null,o.initialize(),o.setOptions(t)}var o={escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.className=e,t.style.position="absolute",t.style.display="none",t}},n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};i.utils=o,(h.Autocomplete=i).formatResult=function(e,t){var n="("+o.escapeRegExChars(t)+")";return e.value.replace(new RegExp(n,"gi"),"<strong>$1</strong>").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/&lt;(\/?strong)&gt;/g,"<$1>")},i.prototype={killerFn:null,initialize:function(){var e,t=this,n="."+t.classes.suggestion,o=t.classes.selected,s=t.options;t.element.setAttribute("autocomplete","off"),t.killerFn=function(e){0===h(e.target).closest("."+t.options.containerClass).length&&(t.killSuggestions(),t.disableKillerFn())},t.noSuggestionsContainer=h('<div class="autocomplete-no-suggestion"></div>').html(this.options.noSuggestionNotice).get(0),t.suggestionsContainer=i.utils.createNode(s.containerClass),(e=h(t.suggestionsContainer)).appendTo(s.appendTo),"auto"!==s.width&&e.width(s.width),e.on("mouseover.autocomplete",n,function(){t.activate(h(this).data("index"))}),e.on("mouseout.autocomplete",function(){t.selectedIndex=-1,e.children("."+o).removeClass(o)}),e.on("click.autocomplete",n,function(){t.select(h(this).data("index"))}),t.fixPositionCapture=function(){t.visible&&t.fixPosition()},h(window).on("resize.autocomplete",t.fixPositionCapture),t.el.on("keydown.autocomplete",function(e){t.onKeyPress(e)}),t.el.on("keyup.autocomplete",function(e){t.onKeyUp(e)}),t.el.on("blur.autocomplete",function(){t.onBlur()}),t.el.on("focus.autocomplete",function(){t.onFocus()}),t.el.on("change.autocomplete",function(e){t.onKeyUp(e)}),t.el.on("input.autocomplete",function(e){t.onKeyUp(e)})},onFocus:function(){var e=this;e.fixPosition(),0===e.options.minChars&&0===e.el.val().length&&e.onValueChange()},onBlur:function(){this.enableKillerFn()},abortAjax:function(){var e=this;e.currentRequest&&(e.currentRequest.abort(),e.currentRequest=null)},setOptions:function(e){var t=this,n=t.options;h.extend(n,e),t.isLocal=h.isArray(n.lookup),t.isLocal&&(n.lookup=t.verifySuggestionsFormat(n.lookup)),n.orientation=t.validateOrientation(n.orientation,"bottom"),h(t.suggestionsContainer).css({"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex})},clearCache:function(){this.cachedResponse={},this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){var e=this;e.disabled=!0,clearInterval(e.onChangeInterval),e.abortAjax()},enable:function(){this.disabled=!1},fixPosition:function(){var e=this,t=h(e.suggestionsContainer),n=t.parent().get(0);if(n===document.body||e.options.forceFixPosition){var o=e.options.orientation,s=t.outerHeight(),i=e.el.outerHeight(),a=e.el.offset(),l={top:a.top,left:a.left};if("auto"===o){var r=h(window).height(),u=h(window).scrollTop(),c=-u+a.top-s,g=u+r-(a.top+i+s);o=Math.max(c,g)===c?"top":"bottom"}if(l.top+="top"===o?-s:i,n!==document.body){var d,p=t.css("opacity");e.visible||t.css("opacity",0).show(),d=t.offsetParent().offset(),l.top-=d.top,l.left-=d.left,e.visible||t.css("opacity",p).hide()}"auto"===e.options.width&&(l.width=e.el.outerWidth()-2+"px"),t.css(l)}},enableKillerFn:function(){var e=this;h(document).on("click.autocomplete",e.killerFn)},disableKillerFn:function(){var e=this;h(document).off("click.autocomplete",e.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.visible&&(e.el.val(e.currentValue),e.hide()),e.stopKillSuggestions()},50)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this,n=t.el.val().length,o=t.element.selectionStart;return"number"==typeof o?o===n:!document.selection||((e=document.selection.createRange()).moveStart("character",-n),n===e.text.length)},onKeyPress:function(e){var t=this;if(t.disabled||t.visible||e.which!==n.DOWN||!t.currentValue){if(!t.disabled&&t.visible){switch(e.which){case n.ESC:t.el.val(t.currentValue),t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex),!1===t.options.tabDisabled)return;break;case n.RETURN:if(-1===t.selectedIndex)return void t.hide();t.select(t.selectedIndex);break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}}else t.suggest()},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case n.UP:case n.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),0<t.options.deferRequestBy?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e=this,t=e.options,n=e.el.val(),o=e.getQuery(n);e.selection&&e.currentValue!==o&&(e.selection=null,(t.onInvalidateSelection||h.noop).call(e.element)),clearInterval(e.onChangeInterval),e.currentValue=n,e.selectedIndex=-1,t.triggerSelectOnValidInput&&e.isExactMatch(o)?e.select(0):o.length<t.minChars?e.hide():e.getSuggestions(o)},isExactMatch:function(e){var t=this.suggestions;return 1===t.length&&t[0].value.toLowerCase()===e.toLowerCase()},getQuery:function(e){var t,n=this.options.delimiter;return n?(t=e.split(n),h.trim(t[t.length-1])):e},getSuggestionsLocal:function(t){var e,n=this.options,o=t.toLowerCase(),s=n.lookupFilter,i=parseInt(n.lookupLimit,10);return e={suggestions:h.grep(n.lookup,function(e){return s(e,t,o)})},i&&e.suggestions.length>i&&(e.suggestions=e.suggestions.slice(0,i)),e},getSuggestions:function(o){var e,t,n,s,i=this,a=i.options,l=a.serviceUrl;a.params[a.paramName]=o,t=a.ignoreParams?null:a.params,!1!==a.onSearchStart.call(i.element,a.params)&&(h.isFunction(a.lookup)?a.lookup(o,function(e){i.suggestions=e.suggestions,i.suggest(),a.onSearchComplete.call(i.element,o,e.suggestions)}):(i.isLocal?e=i.getSuggestionsLocal(o):(h.isFunction(l)&&(l=l.call(i.element,o)),n=l+"?"+h.param(t||{}),e=i.cachedResponse[n]),e&&h.isArray(e.suggestions)?(i.suggestions=e.suggestions,i.suggest(),a.onSearchComplete.call(i.element,o,e.suggestions)):i.isBadQuery(o)?a.onSearchComplete.call(i.element,o,[]):(i.abortAjax(),s={url:l,data:t,type:a.type,dataType:a.dataType},h.extend(s,a.ajaxSettings),i.currentRequest=h.ajax(s).done(function(e){var t;i.currentRequest=null,t=a.transformResult(e,o),i.processResponse(t,o,n),a.onSearchComplete.call(i.element,o,t.suggestions)}).fail(function(e,t,n){a.onSearchError.call(i.element,o,e,t,n)}))))},isBadQuery:function(e){if(!this.options.preventBadQueries)return!1;for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var e=this,t=h(e.suggestionsContainer);h.isFunction(e.options.onHide)&&e.visible&&e.options.onHide.call(e.element,t),e.visible=!1,e.selectedIndex=-1,clearInterval(e.onChangeInterval),h(e.suggestionsContainer).hide(),e.signalHint(null)},suggest:function(){if(0!==this.suggestions.length){var n,e=this,t=e.options,o=t.groupBy,s=t.formatResult,i=e.getQuery(e.currentValue),a=e.classes.suggestion,l=e.classes.selected,r=h(e.suggestionsContainer),u=h(e.noSuggestionsContainer),c=t.beforeRender,g="",d=function(e){var t=e.data[o];return n===t?"":'<div class="autocomplete-group"><strong>'+(n=t)+"</strong></div>"};t.triggerSelectOnValidInput&&e.isExactMatch(i)?e.select(0):(h.each(e.suggestions,function(e,t){o&&(g+=d(t,i,e)),g+='<div class="'+a+'" data-index="'+e+'">'+s(t,i)+"</div>"}),this.adjustContainerWidth(),u.detach(),r.html(g),h.isFunction(c)&&c.call(e.element,r),e.fixPosition(),r.show(),t.autoSelectFirst&&(e.selectedIndex=0,r.scrollTop(0),r.children("."+a).first().addClass(l)),e.visible=!0,e.findBestHint())}else this.options.showNoSuggestionNotice?this.noSuggestions():this.hide()},noSuggestions:function(){var e=this,t=h(e.suggestionsContainer),n=h(e.noSuggestionsContainer);this.adjustContainerWidth(),n.detach(),t.empty(),t.append(n),e.fixPosition(),t.show(),e.visible=!0},adjustContainerWidth:function(){var e,t=this,n=t.options,o=h(t.suggestionsContainer);"auto"===n.width&&(e=t.el.outerWidth()-2,o.width(0<e?e:300))},findBestHint:function(){var e=this,o=e.el.val().toLowerCase(),s=null;o&&(h.each(e.suggestions,function(e,t){var n=0===t.value.toLowerCase().indexOf(o);return n&&(s=t),!n}),e.signalHint(s))},signalHint:function(e){var t="",n=this;e&&(t=n.currentValue+e.value.substr(n.currentValue.length)),n.hintValue!==t&&(n.hintValue=t,n.hint=e,(this.options.onHint||h.noop)(t))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?h.map(e,function(e){return{value:e,data:null}}):e},validateOrientation:function(e,t){return e=h.trim(e||"").toLowerCase(),-1===h.inArray(e,["auto","bottom","top"])&&(e=t),e},processResponse:function(e,t,n){var o=this,s=o.options;e.suggestions=o.verifySuggestionsFormat(e.suggestions),s.noCache||(o.cachedResponse[n]=e,s.preventBadQueries&&0===e.suggestions.length&&o.badQueries.push(t)),t===o.getQuery(o.currentValue)&&(o.suggestions=e.suggestions,o.suggest())},activate:function(e){var t,n=this,o=n.classes.selected,s=h(n.suggestionsContainer),i=s.find("."+n.classes.suggestion);return s.find("."+o).removeClass(o),n.selectedIndex=e,-1!==n.selectedIndex&&i.length>n.selectedIndex?(t=i.get(n.selectedIndex),h(t).addClass(o),t):null},selectHint:function(){var e=this,t=h.inArray(e.hint,e.suggestions);e.select(t)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var e=this;if(-1!==e.selectedIndex)return 0===e.selectedIndex?(h(e.suggestionsContainer).children().first().removeClass(e.classes.selected),e.selectedIndex=-1,e.el.val(e.currentValue),void e.findBestHint()):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var t=this,n=t.activate(e);if(n){var o,s,i,a=h(n).outerHeight();o=n.offsetTop,i=(s=h(t.suggestionsContainer).scrollTop())+t.options.maxHeight-a,o<s?h(t.suggestionsContainer).scrollTop(o):i<o&&h(t.suggestionsContainer).scrollTop(o-t.options.maxHeight+a),t.options.preserveInput||t.el.val(t.getValue(t.suggestions[e].value)),t.signalHint(null)}},onSelect:function(e){var t=this,n=t.options.onSelect,o=t.suggestions[e];t.currentValue=t.getValue(o.value),t.currentValue===t.el.val()||t.options.preserveInput||t.el.val(t.currentValue),t.signalHint(null),t.suggestions=[],t.selection=o,h.isFunction(n)&&n.call(t.element,o)},getValue:function(e){var t,n,o=this,s=o.options.delimiter;return s?1===(n=(t=o.currentValue).split(s)).length?e:t.substr(0,t.length-n[n.length-1].length)+e:e},dispose:function(){var e=this;e.el.off(".autocomplete").removeData("autocomplete"),e.disableKillerFn(),h(window).off("resize.autocomplete",e.fixPositionCapture),h(e.suggestionsContainer).remove()}},h.fn.autocomplete=h.fn.devbridgeAutocomplete=function(n,o){var s="autocomplete";return 0===arguments.length?this.first().data(s):this.each(function(){var e=h(this),t=e.data(s);"string"==typeof n?t&&"function"==typeof t[n]&&t[n](o):(t&&t.dispose&&t.dispose(),t=new i(this,n),e.data(s,t))})}});